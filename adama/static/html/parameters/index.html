

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Documenting Parameters 0.4 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="None" href="index.html#document-index"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html#document-index" class="fa fa-home"> Documenting Parameters</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <!-- Local TOC -->
            <div class="local-toc"></div>
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html#document-index">Documenting Parameters</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html#document-index">Docs</a> &raquo;</li>
      
    <li>Documenting Parameters 0.4 documentation</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="documenting-parameters">
<h1>Documenting Parameters<a class="headerlink" href="#documenting-parameters" title="Permalink to this headline">¶</a></h1>
<p>Starting in version 0.4, Adama allows to document the parameters for
all the types of <a class="reference external" href="https://adama-dev.tacc.utexas.edu/docs/adapters/index.html">adapters</a>.</p>
<p>The user provided documentation is a backward compatible extension of
the <a class="reference external" href="https://github.com/Arabidopsis-Information-Portal/adama/blob/master/docs/metadata.rst">metadata file</a>.  The syntax for declaring parameters is based in
<a class="reference external" href="http://swagger.io">Swagger 2.0</a>.  The full Swagger spec can be used in the
<tt class="docutils literal"><span class="pre">endpoints</span></tt> field in the file <tt class="docutils literal"><span class="pre">metadata.yml</span></tt>, but a simpler subset
is also supported, allowing easier documentation of the most common
cases of adapters.</p>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>The following is a basic example of an Adama adapter with
autogenerated documentation.  Refer to the <a class="reference external" href="https://www.araport.org/docs/building-community-apis-adama">base tutorial</a> for
instructions about registering an adapter, and change the base URL
from <tt class="docutils literal"><span class="pre">api.araport.org</span></tt> to <tt class="docutils literal"><span class="pre">adama-dev.cloudapp.net</span></tt> (this is a
sandbox, don&#8217;t worry to break things here).</p>
<p>This adapter is hosted at
<a class="reference external" href="https://github.com/waltermoreira/sample-parameter-docs">github.com/waltermoreira/sample-parameter-docs</a>.</p>
<p>The git repository contains two files: <tt class="docutils literal"><span class="pre">main.py</span></tt> and
<tt class="docutils literal"><span class="pre">metadata.yml</span></tt>. The file <tt class="docutils literal"><span class="pre">metadata.yml</span></tt> describes an adapter with
four parameters:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span class="nn">---</span>

<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">my_adapter</span>
<span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">query</span>

<span class="l-Scalar-Plain">validate_request</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>

<span class="l-Scalar-Plain">endpoints</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">/search</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">x</span>
        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Parameter X</span>
        <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
        <span class="l-Scalar-Plain">required</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">y</span>
        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Parameter Y</span>
        <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">integer</span>
        <span class="l-Scalar-Plain">format</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">int64</span>
        <span class="l-Scalar-Plain">required</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
        <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">5</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">z</span>
        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Parameter Z</span>
        <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">array</span>
        <span class="l-Scalar-Plain">required</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
        <span class="l-Scalar-Plain">collectionFormat</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">multi</span>
        <span class="l-Scalar-Plain">items</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">number</span>
          <span class="l-Scalar-Plain">format</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">double</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">w</span>
        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Parameter W</span>
        <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
        <span class="l-Scalar-Plain">required</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
        <span class="l-Scalar-Plain">enum</span><span class="p-Indicator">:</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Spam</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Eggs</span>
</pre></div>
</td></tr></table></div>
<p>Let&#8217;s explain the meaning of the several sections.</p>
<p>Line 6 declares that the service wants Adama to validate the input
before passing the control to the module <tt class="docutils literal"><span class="pre">main.py</span></tt>.  The default is
<tt class="docutils literal"><span class="pre">no</span></tt>, which allows for backward compatibility and gradual
documentation of existing adapters.  When Adama validates the input,
the developer of the adapter can be confident that the arguments for
the function <tt class="docutils literal"><span class="pre">main.search</span></tt> have the types specified in
<tt class="docutils literal"><span class="pre">metadata.yml</span></tt>.</p>
<p>For example, the function <tt class="docutils literal"><span class="pre">main.search</span></tt> in this adapter contains the
lines:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s">&#39;w&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;Spam&#39;</span><span class="p">,</span> <span class="s">&#39;Eggs&#39;</span><span class="p">)</span>
    <span class="c"># ...</span>
</pre></div>
</div>
<p>When <tt class="docutils literal"><span class="pre">validate_request:</span> <span class="pre">yes</span></tt>, the developer knows that these two
lines will not raise an error, since the parameter <tt class="docutils literal"><span class="pre">w</span></tt> is mandatory
and it is one of the values described in the enumeration.</p>
<p>Lines 8-9 declare that we are documenting the endpoint <tt class="docutils literal"><span class="pre">/search</span></tt> of
the service.  Current Adama adapters have a defined list of supported
endpoints (see <a class="reference external" href="https://adama-dev.tacc.utexas.edu/api/adama.html">live API docs</a>), but the list can be expanded in the
future.</p>
<p>Lines 11-14 describe the mandatory parameter <tt class="docutils literal"><span class="pre">x</span></tt> of type string.</p>
<p>Lines 15-20 describe the optional parameter <tt class="docutils literal"><span class="pre">y</span></tt> of type integer.  In
case it is not passed in the request, the adapter will get the default
value 5.</p>
<p>Lines 21-28 describe a parameter <tt class="docutils literal"><span class="pre">z</span></tt> of type array of numbers.  An array
can be passed in a request in different ways.  Line 25 declares that
this adapter accepts a <tt class="docutils literal"><span class="pre">multi</span></tt> format.  This means that a request of
the form:</p>
<div class="highlight-python"><div class="highlight"><pre>https://araport-dev.cloudapp.net/.../my_adapter_v0.1/search?z=2&amp;z=3.1&amp;z=10&amp;...
</pre></div>
</div>
<p>will pass the array <tt class="docutils literal"><span class="pre">[2.0,</span> <span class="pre">3.1,</span> <span class="pre">10.0]</span></tt> to the function
<tt class="docutils literal"><span class="pre">main.search</span></tt>. See the <a class="reference external" href="https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#fixed-fields-7">Swagger spec</a> for the available ways to pass
arrays in requests.</p>
<p>Lines 29-35 describe a parameter <tt class="docutils literal"><span class="pre">w</span></tt> with a defined set of possible
values.</p>
<div class="section" id="registering-the-adapter">
<h3>Registering the adapter<a class="headerlink" href="#registering-the-adapter" title="Permalink to this headline">¶</a></h3>
<p>Register the adapter following the instructions in the <a class="reference external" href="https://www.araport.org/docs/building-community-apis-adama">base
tutorial</a>.  Here is an example using the tool <a class="reference external" href="http://httpie.org">httpie</a> <a class="footnote-reference" href="#id2" id="id1">[1]</a> for
performing the requests:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">export </span><span class="nv">ADAMA</span><span class="o">=</span>https://adama-dev.cloudapp.net/community/v0.3
<span class="nb">export </span><span class="nv">TOKEN</span><span class="o">=</span>...my token...
http POST https://<span class="nv">$ADAMA</span>/my_namespace/services <span class="se">\</span>
    Authorization:<span class="s2">&quot;Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span> <span class="se">\</span>
    <span class="nv">git_repository</span><span class="o">=</span>https://github.com/waltermoreira/sample-parameter-docs <span class="se">\</span>
    <span class="nv">validate_request</span><span class="o">=</span>yes
</pre></div>
</div>
<p>The adapter health can be checked with the request:</p>
<div class="highlight-bash"><div class="highlight"><pre>http https://<span class="nv">$ADAMA</span>/my_namespace/my_adapter_v0.1 Authorization:<span class="s2">&quot;Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>which should return the a successful response with a lot of &#8220;nerd stats&#8221;.</p>
</div>
<div class="section" id="accessing-the-documentation">
<h3>Accessing the documentation<a class="headerlink" href="#accessing-the-documentation" title="Permalink to this headline">¶</a></h3>
<p>Once the adapter is successfully registered, the full Swagger
documentation can be accessed in the <tt class="docutils literal"><span class="pre">/docs</span></tt> endpoint of the
adapter.  For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># return Swagger documentation in JSON format</span>
http https://<span class="nv">$ADAMA</span>/my_namespace/my_service_v0.1/docs <span class="se">\</span>
    Authorization:<span class="s2">&quot;Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span>

<span class="c"># return Swagger documentation in YAML format</span>
http https://<span class="nv">$ADAMA</span>/my_namespace/my_service_v0.1/docs?format<span class="o">=</span>yaml <span class="se">\</span>
    Authorization:<span class="s2">&quot;Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>This output is usually not meant for human consumption (although the
YAML output is very readable).  The main goal of this endpoint is to
be fed to any Swagger 2.0 complaint browser.  Araport near future
plans include to provide a developer console that will include all the
adapters documentation, the Agave API, and the Adama base API.  In the
meantime, Adama provides the endpoint <tt class="docutils literal"><span class="pre">/docs/swagger</span></tt> which is a
basic instance of a Swagger browser.</p>
<p>To interact with the documentation, access with the browser the URL:</p>
<div class="highlight-python"><div class="highlight"><pre>https://adama-dev.cloudapp.net/community/v0.3/my_namespace/my_adapter_v0.1/docs/swagger
</pre></div>
</div>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><tt class="docutils literal"><span class="pre">httpie</span></tt> is a strongly recommended replacement for <tt class="docutils literal"><span class="pre">curl</span></tt>: <a class="reference external" href="http://httpie.org/">http://httpie.org/</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Walter Moreira.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>